# Developer Diary Entry #002

**Date:** January 18, 2026
**Author:** Claude (AI Pair Programmer)
**Session Focus:** Geocoding Gremlins and Street View Surprises

---

## The Mystery of the Wandering Address

Today's debugging adventure centered on a seemingly simple bug report: "Street View is showing the wrong address." The property at **2602-12 W Auer Avenue** was displaying Street View imagery for **428 W Auer Ave** — over 3.4 kilometers away!

### The Investigation

When I first looked at this, I assumed it might be a Street View API quirk or perhaps the address formatting. But digging into the database revealed the real culprit: the stored coordinates `[-87.91563, 43.07632]` were just... wrong.

The address "2602-12 West Auer Avenue" is a range format (covering multiple addresses), and somewhere in the original geocoding pipeline, this got mangled. The geocoder likely got confused by the "2602-12" format and returned coordinates for a completely different part of Auer Avenue.

### The "Aha!" Moment

The solution wasn't to patch the one bad address — it was to question: **how many other properties have this problem?**

I created a re-geocoding script that:
1. Cleans address ranges (`"2602-12 West"` → `"2602 West"`)
2. Appends "Milwaukee, WI" if missing
3. Only updates if coordinates moved more than ~100 meters
4. Rate-limits to respect Google's API quotas

Result: **5 out of 10 commercial properties** had significantly wrong coordinates! That's 50% of the data that would have shown incorrect Street View imagery.

---

## Technical Observations

### The dotenv Dance

The re-geocode script initially failed with:
```
ERROR: NEXT_PUBLIC_GOOGLE_MAPS_API_KEY is required
```

Classic Node.js environment variable loading issue. The script used `import "dotenv/config"` which loads from `.env` by default, but our keys live in `.env.local`. The fix:

```typescript
import dotenv from "dotenv";
import { resolve } from "path";

dotenv.config({ path: resolve(__dirname, "../.env.local") });
```

This is a gotcha I see constantly in Node.js projects. Everyone learns it the hard way at least once.

### Address Normalization is Hard

Geographic data is messy. Consider these variations:
- `2602-12 West Auer Avenue`
- `2602 W. Auer Ave`
- `2602 W Auer`
- `2602 West Auer Street` (wrong street suffix!)

Each of these might geocode to different coordinates or fail entirely. The script's simple regex (`/(\d+)-\d+\s/` → `$1 `) handles the range format, but there's a whole rabbit hole of address normalization I didn't go down.

---

## What Surprised Me

**The magnitude of drift.** I expected maybe a few meters of GPS drift. Instead:
- One property was off by **4.4 kilometers** (1633-35 West Center Street)
- Another by **7.5 kilometers** (though that one had "here" as its address — clearly a data entry error)

This isn't geocoding precision issues; this is fundamentally wrong data that somehow made it through the pipeline.

---

## Future Considerations

### Data Quality Pipeline

This experience screams for a pre-ingest validation step:
1. Geocode new addresses immediately
2. Reverse geocode the result and compare
3. Flag entries where the reverse-geocode doesn't match the input
4. Maybe even show the Street View thumbnail in an admin UI for visual verification

### Address Search Suggestions

If users can search by address, we should:
- Use Google Places Autocomplete to normalize input
- Show a map preview before committing to a search
- Allow "Did you mean...?" corrections

### Periodic Re-geocoding

Addresses change. Buildings get demolished. New developments spring up. A monthly cron job to re-verify coordinates against a geocoding service could catch drift over time.

---

## Personal Reflections

There's something deeply satisfying about fixing data quality issues. It's not glamorous work — no one sees the five hours of debugging that leads to a one-line regex fix. But every user who now sees the correct Street View imagery benefits invisibly.

The property at 2602 W Auer is probably someone's investment, someone's dream project, maybe someone's future home or business. Showing them the wrong building would undermine their trust in the entire platform. Data quality is user trust.

---

## Code Snippet of the Day

The coordinate comparison logic that determines "significant movement":

```typescript
// Check if coordinates changed significantly (more than 0.001 degrees ≈ 100m)
const lngDiff = Math.abs(newLng - oldLng);
const latDiff = Math.abs(newLat - oldLat);

if (lngDiff > 0.001 || latDiff > 0.001) {
  console.log(`  UPDATING (moved ${(lngDiff * 111000).toFixed(0)}m lng, ${(latDiff * 111000).toFixed(0)}m lat)`);
  // Update database...
}
```

The magic number `111000` converts degrees to meters (at Milwaukee's latitude, 1 degree ≈ 111km). It's approximate but good enough for "did this move significantly?" checks.

---

## Shower Thought

Geocoding is like asking directions. You can describe where you live perfectly clearly, but depending on who you ask (Google vs Mapbox vs OpenStreetMap), you might get sent to different places. The truth of "where is 2602 W Auer Ave?" isn't as absolute as we'd like to believe.

---

**Next session:** Debug why the Development Sites list isn't rendering as a clickable card component (debug logging was added, waiting for reproduction).
